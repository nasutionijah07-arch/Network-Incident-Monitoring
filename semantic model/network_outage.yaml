name: Network_Analytics_Datamodel
tables:
  - name: DIM_CITY
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: DIM_CITY
    primary_key:
      columns:
        - CITY_KEY
    dimensions:
      - name: CITY_KEY
        synonyms: [city_id, city_code]
        description: Surrogate key for city.
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: CITY
        synonyms: [town, municipality]
        description: City name.
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: PROVINCE
        synonyms: [state, wilayah]
        description: Province/state of the city.
        expr: PROVINCE
        data_type: VARCHAR(16777216)
      - name: REGION
        synonyms: [area, zone]
        description: Business region of the city.
        expr: REGION
        data_type: VARCHAR(16777216)

  - name: DIM_OLT
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: DIM_OLT
    primary_key:
      columns:
        - OLT_KEY
    dimensions:
      - name: OLT_KEY
        synonyms: [olt_key_id]
        description: Surrogate key for OLT.
        expr: OLT_KEY
        data_type: NUMBER(38,0)
      - name: OLT_ID
        synonyms: [olt_identifier]
        description: Business identifier for OLT.
        expr: OLT_ID
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        synonyms: [city_fk]
        description: Foreign key to DIM_CITY.
        expr: CITY_KEY
        data_type: NUMBER(38,0)

  - name: DIM_CLUSTER
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: DIM_CLUSTER
    primary_key:
      columns:
        - CLUSTER_KEY
    dimensions:
      - name: CLUSTER_KEY
        synonyms: [cluster_surrogate_key]
        description: Surrogate key for cluster.
        expr: CLUSTER_KEY
        data_type: NUMBER(38,0)
      - name: CLUSTER_ID
        synonyms: [cluster_code]
        description: Business identifier for cluster.
        expr: CLUSTER_ID
        data_type: VARCHAR(16777216)
      - name: CLUSTER_NAME
        synonyms: [cluster_label]
        description: Human-friendly cluster name.
        expr: CLUSTER_NAME
        data_type: VARCHAR(16777216)
      - name: OLT_KEY
        synonyms: [olt_fk]
        description: Foreign key to DIM_OLT.
        expr: OLT_KEY
        data_type: NUMBER(38,0)
      - name: CITY_KEY
        synonyms: [city_fk]
        description: Foreign key to DIM_CITY.
        expr: CITY_KEY
        data_type: NUMBER(38,0)

  - name: FACT_NETWORK_CONTEXT_STATIC
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_NETWORK_CONTEXT_STATIC
    dimensions:
      - name: CITY
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: PROVINCE
        expr: PROVINCE
        data_type: VARCHAR(16777216)
      - name: REGION
        expr: REGION
        data_type: VARCHAR(16777216)
      - name: OLT_ID
        expr: OLT_ID
        data_type: VARCHAR(16777216)
      - name: OLT_KEY
        expr: OLT_KEY
        data_type: NUMBER(38,0)
      - name: FDT_NAME
        expr: FDT_NAME
        data_type: VARCHAR(16777216)
      - name: FAT_NAME
        expr: FAT_NAME
        data_type: VARCHAR(16777216)
      - name: CLUSTER_ID
        expr: CLUSTER_ID
        data_type: VARCHAR(16777216)
      - name: CLUSTER_KEY
        expr: CLUSTER_KEY
        data_type: NUMBER(38,0)
      - name: CLUSTER_NAME
        expr: CLUSTER_NAME
        data_type: VARCHAR(16777216)
      - name: VENDOR
        expr: VENDOR
        data_type: VARCHAR(16777216)
      - name: FIRMWARE_VERSION
        expr: FIRMWARE_VERSION
        data_type: VARCHAR(16777216)

  - name: FACT_ONT_STATUS
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_ONT_STATUS
    primary_key:
      columns:
        - TIMESTAMP_1H
        - OLT_ID
        - CLUSTER_ID
    time_dimensions:
      - name: TIMESTAMP_1H
        expr: TIMESTAMP_1H
        data_type: TIMESTAMP_NTZ
      - name: DATE
        expr: DATE
        data_type: DATE
    dimensions:
      - name: CITY
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: PROVINCE
        expr: PROVINCE
        data_type: VARCHAR(16777216)
      - name: REGION
        expr: REGION
        data_type: VARCHAR(16777216)
      - name: OLT_ID
        expr: OLT_ID
        data_type: VARCHAR(16777216)
      - name: OLT_KEY
        expr: OLT_KEY
        data_type: NUMBER(38,0)
      - name: FDT_NAME
        expr: FDT_NAME
        data_type: VARCHAR(16777216)
      - name: FAT_NAME
        expr: FAT_NAME
        data_type: VARCHAR(16777216)
      - name: CLUSTER_ID
        expr: CLUSTER_ID
        data_type: VARCHAR(16777216)
      - name: CLUSTER_KEY
        expr: CLUSTER_KEY
        data_type: NUMBER(38,0)
      - name: CLUSTER_NAME
        expr: CLUSTER_NAME
        data_type: VARCHAR(16777216)
      - name: HOUR_OF_DAY
        expr: HOUR_OF_DAY
        data_type: NUMBER(38,0)
      - name: DAY_OF_WEEK
        expr: DAY_OF_WEEK
        data_type: NUMBER(38,0)
      - name: IS_MAINTENANCE_WINDOW
        expr: IS_MAINTENANCE_WINDOW
        data_type: BOOLEAN
      - name: PRECURSOR_FLAG
        expr: PRECURSOR_FLAG
        data_type: BOOLEAN
    facts:
      - name: ONT_REGISTERED
        expr: ONT_REGISTERED
        data_type: NUMBER(38,0)
      - name: OFFLINE_ONT_NOW
        expr: OFFLINE_ONT_NOW
        data_type: NUMBER(38,0)
      - name: OFFLINE_ONT_RATIO
        expr: OFFLINE_ONT_RATIO
        data_type: FLOAT
      - name: LINK_LOSS_COUNT
        expr: LINK_LOSS_COUNT
        data_type: NUMBER(38,0)
      - name: BAD_RSL_COUNT
        expr: BAD_RSL_COUNT
        data_type: NUMBER(38,0)
      - name: HIGH_TEMP_COUNT
        expr: HIGH_TEMP_COUNT
        data_type: NUMBER(38,0)
      - name: DYING_GASP_COUNT
        expr: DYING_GASP_COUNT
        data_type: NUMBER(38,0)
      - name: ALARM_SPIKE_FLAG
        expr: ALARM_SPIKE_FLAG
        data_type: BOOLEAN
      - name: TRAP_TREND_SCORE
        expr: TRAP_TREND_SCORE
        data_type: FLOAT
      - name: SNR_AVG
        expr: SNR_AVG
        data_type: FLOAT
      - name: RX_POWER_AVG
        expr: RX_POWER_AVG
        data_type: FLOAT
      - name: RX_POWER_AVG_DBM
        expr: RX_POWER_AVG_DBM
        data_type: FLOAT
      - name: TEMPERATURE_AVG_C
        expr: TEMPERATURE_AVG_C
        data_type: FLOAT
      - name: TEMP_ANOMALY_SCORE
        expr: TEMP_ANOMALY_SCORE
        data_type: FLOAT
      - name: OUTAGE_NOW
        expr: OUTAGE_NOW
        data_type: BOOLEAN
      - name: STRESS
        expr: STRESS
        data_type: FLOAT
      - name: FAULT_RATE
        expr: FAULT_RATE
        data_type: FLOAT

  - name: FACT_ML_FEATURES
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_ML_FEATURES
    primary_key:
      columns:
        - TIMESTAMP_1H
        - OLT_ID
        - CLUSTER_ID
    time_dimensions:
      - name: TIMESTAMP_1H
        expr: TIMESTAMP_1H
        data_type: TIMESTAMP_NTZ
    dimensions:
      - name: CITY
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: PROVINCE
        expr: PROVINCE
        data_type: VARCHAR(16777216)
      - name: REGION
        expr: REGION
        data_type: VARCHAR(16777216)
      - name: OLT_ID
        expr: OLT_ID
        data_type: VARCHAR(16777216)
      - name: OLT_KEY
        expr: OLT_KEY
        data_type: NUMBER(38,0)
      - name: FDT_NAME
        expr: FDT_NAME
        data_type: VARCHAR(16777216)
      - name: FAT_NAME
        expr: FAT_NAME
        data_type: VARCHAR(16777216)
      - name: CLUSTER_ID
        expr: CLUSTER_ID
        data_type: VARCHAR(16777216)
      - name: CLUSTER_KEY
        expr: CLUSTER_KEY
        data_type: NUMBER(38,0)
      - name: CLUSTER_NAME
        expr: CLUSTER_NAME
        data_type: VARCHAR(16777216)
      - name: HOUR_OF_DAY
        expr: HOUR_OF_DAY
        data_type: NUMBER(38,0)
      - name: DAY_OF_WEEK
        expr: DAY_OF_WEEK
        data_type: NUMBER(38,0)
      - name: IS_MAINTENANCE_WINDOW
        expr: IS_MAINTENANCE_WINDOW
        data_type: BOOLEAN
      - name: ROW_NUMBER
        expr: ROW_NUMBER
        data_type: NUMBER(38,0)
    facts:
      - name: ONT_REGISTERED
        expr: ONT_REGISTERED
        data_type: NUMBER(38,0)
      - name: OFFLINE_ONT_NOW
        expr: OFFLINE_ONT_NOW
        data_type: NUMBER(38,0)
      - name: OFFLINE_ONT_RATIO
        expr: OFFLINE_ONT_RATIO
        data_type: FLOAT
      - name: LINK_LOSS_COUNT
        expr: LINK_LOSS_COUNT
        data_type: NUMBER(38,0)
      - name: BAD_RSL_COUNT
        expr: BAD_RSL_COUNT
        data_type: NUMBER(38,0)
      - name: HIGH_TEMP_COUNT
        expr: HIGH_TEMP_COUNT
        data_type: NUMBER(38,0)
      - name: DYING_GASP_COUNT
        expr: DYING_GASP_COUNT
        data_type: NUMBER(38,0)
      - name: ALARM_SPIKE_FLAG
        expr: ALARM_SPIKE_FLAG
        data_type: BOOLEAN
      - name: TRAP_TREND_SCORE
        expr: TRAP_TREND_SCORE
        data_type: FLOAT
      - name: FAULT_RATE
        expr: FAULT_RATE
        data_type: FLOAT
      - name: SNR_AVG
        expr: SNR_AVG
        data_type: FLOAT
      - name: RX_POWER_AVG
        expr: RX_POWER_AVG
        data_type: FLOAT
      - name: RX_POWER_AVG_DBM
        expr: RX_POWER_AVG_DBM
        data_type: FLOAT
      - name: TEMPERATURE_AVG_C
        expr: TEMPERATURE_AVG_C
        data_type: FLOAT
      - name: TEMP_ANOMALY_SCORE
        expr: TEMP_ANOMALY_SCORE
        data_type: FLOAT
      - name: LABEL_OUTAGE_1H
        expr: LABEL_OUTAGE_1H
        data_type: BOOLEAN

  - name: FACT_CUSTOMER_FEEDBACK
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_CUSTOMER_FEEDBACK
    primary_key:
      columns:
        - FEEDBACK_ID
    time_dimensions:
      - name: JOIN_DATE
        expr: JOIN_DATE
        data_type: DATE
      - name: ACTIVE_DATE
        expr: ACTIVE_DATE
        data_type: DATE
      - name: LAST_ONLINE_TS
        expr: LAST_ONLINE_TS
        data_type: TIMESTAMP_NTZ
      - name: LAST_OFFLINE_TS
        expr: LAST_OFFLINE_TS
        data_type: TIMESTAMP_NTZ
    dimensions:
      - name: CITY
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: PROVINCE
        expr: PROVINCE
        data_type: VARCHAR(16777216)
      - name: REGION
        expr: REGION
        data_type: VARCHAR(16777216)
      - name: OLT_ID
        expr: OLT_ID
        data_type: VARCHAR(16777216)
      - name: OLT_KEY
        expr: OLT_KEY
        data_type: NUMBER(38,0)
      - name: CLUSTER_ID
        expr: CLUSTER_ID
        data_type: VARCHAR(16777216)
      - name: CLUSTER_KEY
        expr: CLUSTER_KEY
        data_type: NUMBER(38,0)
      - name: CLUSTER_NAME
        expr: CLUSTER_NAME
        data_type: VARCHAR(16777216)
      - name: CUSTOMER_ID
        expr: CUSTOMER_ID
        data_type: VARCHAR(16777216)
      - name: HOME_PASS
        expr: HOME_PASS
        data_type: VARCHAR(16777216)
      - name: HOME_CONNECT_ID
        expr: HOME_CONNECT_ID
        data_type: VARCHAR(16777216)
      - name: DEVICE_STATUS
        expr: DEVICE_STATUS
        data_type: VARCHAR(16777216)
      - name: DEVICE_LINK_OS
        expr: DEVICE_LINK_OS
        data_type: VARCHAR(16777216)
      - name: OFFLINE_REASON
        expr: OFFLINE_REASON
        data_type: VARCHAR(16777216)
      - name: FEEDBACK_CHANNEL
        expr: FEEDBACK_CHANNEL
        data_type: VARCHAR(16777216)
      - name: FEEDBACK_TOPIC
        expr: FEEDBACK_TOPIC
        data_type: VARCHAR(16777216)
      - name: SENTIMENT_LABEL
        expr: SENTIMENT_LABEL
        data_type: VARCHAR(16777216)
      - name: FEEDBACK_ID
        expr: FEEDBACK_ID
        data_type: VARCHAR(16777216)
      - name: RATING_1_5
        expr: RATING_1_5
        data_type: NUMBER(38,0)
    facts:
      - name: USER_SATISFACTION_SCORE
        expr: USER_SATISFACTION_SCORE
        data_type: NUMBER(38,0)
      - name: COMPLAINTS_THIS_MONTH
        expr: COMPLAINTS_THIS_MONTH
        data_type: NUMBER(38,0)
      - name: LATE_PAYMENT_COUNT
        expr: LATE_PAYMENT_COUNT
        data_type: NUMBER(38,0)
      - name: CHURN_FLAG
        expr: CHURN_FLAG
        data_type: BOOLEAN
      - name: NETWORK_USAGE_GB
        expr: NETWORK_USAGE_GB
        data_type: FLOAT
      - name: CUSTOMER_AGE
        expr: CUSTOMER_AGE
        data_type: NUMBER(38,0)

  - name: FACT_EVENT_TRANSCRIPTS
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_EVENT_TRANSCRIPTS
    primary_key:
      columns:
        - TRANSCRIPT_ID
    time_dimensions:
      - name: TIMESTAMP_1H
        expr: TIMESTAMP_1H
        data_type: TIMESTAMP_NTZ
    dimensions:
      - name: TRANSCRIPT_ID
        expr: TRANSCRIPT_ID
        data_type: VARCHAR(16777216)   # adjust if it's NUMBER
      - name: OLT_ID
        expr: OLT_ID
        data_type: VARCHAR(16777216)
      - name: CLUSTER_ID
        expr: CLUSTER_ID
        data_type: VARCHAR(16777216)
      - name: EVENT_TYPE
        expr: EVENT_TYPE
        data_type: VARCHAR(16777216)
      - name: SEVERITY_BUCKET
        expr: SEVERITY_BUCKET
        data_type: VARCHAR(16777216)
      - name: EVENT_TRANSCRIPT
        expr: EVENT_TRANSCRIPT
        data_type: VARCHAR(16777216)

  - name: FACT_INCIDENT_TREND_SUMMARY
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_INCIDENT_TREND_SUMMARY
    time_dimensions:
      - name: DATE
        expr: DATE
        data_type: DATE
    dimensions:
      - name: CITY
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: REGION
        expr: REGION
        data_type: VARCHAR(16777216)
    facts:
      - name: LINK_LOSS_COUNT
        expr: LINK_LOSS_COUNT
        data_type: NUMBER(38,0)
      - name: BAD_RSL_COUNT
        expr: BAD_RSL_COUNT
        data_type: NUMBER(38,0)
      - name: HIGH_TEMP_COUNT
        expr: HIGH_TEMP_COUNT
        data_type: NUMBER(38,0)
      - name: DYING_GASP_COUNT
        expr: DYING_GASP_COUNT
        data_type: NUMBER(38,0)
      - name: TOTAL_ONTS
        expr: TOTAL_ONTS
        data_type: NUMBER(38,0)
      - name: TOTAL_ALARMS
        expr: TOTAL_ALARMS
        data_type: NUMBER(38,0)
      - name: FAULT_RATE_DAILY
        expr: FAULT_RATE_DAILY
        data_type: FLOAT
      - name: LINK_LOSS_VS_YESTERDAY
        expr: LINK_LOSS_VS_YESTERDAY
        data_type: FLOAT
      - name: BAD_RSL_VS_YESTERDAY
        expr: BAD_RSL_VS_YESTERDAY
        data_type: FLOAT
      - name: HIGH_TEMP_VS_YESTERDAY
        expr: HIGH_TEMP_VS_YESTERDAY
        data_type: FLOAT
      - name: DYING_GASP_VS_YESTERDAY
        expr: DYING_GASP_VS_YESTERDAY
        data_type: FLOAT

  - name: FACT_TICKET_SUMMARY
    base_table:
      database: HACKATHON
      schema: DATAMART
      table: FACT_TICKET_SUMMARY
    time_dimensions:
      - name: DATE
        expr: DATE
        data_type: DATE
      - name: SCHEDULE_TIME
        expr: SCHEDULE_TIME
        data_type: TIMESTAMP_NTZ
    dimensions:
      - name: CITY
        expr: CITY
        data_type: VARCHAR(16777216)
      - name: CITY_KEY
        expr: CITY_KEY
        data_type: NUMBER(38,0)
      - name: REGION
        expr: REGION
        data_type: VARCHAR(16777216)
      - name: CASE_ID
        expr: CASE_ID
        data_type: VARCHAR(16777216)
      - name: XL_ID
        expr: XL_ID
        data_type: VARCHAR(16777216)
      - name: CLOSE_SUBJECT
        expr: CLOSE_SUBJECT
        data_type: VARCHAR(16777216)
      - name: VENDOR
        expr: VENDOR
        data_type: VARCHAR(16777216)
      - name: ACTION_TAKEN
        expr: ACTION_TAKEN
        data_type: VARCHAR(16777216)
      - name: CUSTOMER_ID
        expr: CUSTOMER_ID
        data_type: VARCHAR(16777216)
      - name: RCA_A
        expr: RCA_A
        data_type: VARCHAR(16777216)
      - name: RCA_G
        expr: RCA_G
        data_type: VARCHAR(16777216)
      - name: RCA_D
        expr: RCA_D
        data_type: VARCHAR(16777216)
      - name: INDICATOR_STATUS
        expr: INDICATOR_STATUS
        data_type: VARCHAR(16777216)
      - name: ACTIVE_FLAG
        expr: ACTIVE_FLAG
        data_type: BOOLEAN
    facts:
      - name: TICKET_OPEN
        expr: TICKET_OPEN
        data_type: NUMBER(38,0)
      - name: TICKET_CLOSED
        expr: TICKET_CLOSED
        data_type: NUMBER(38,0)
      - name: ACTIVE_TICKET
        expr: ACTIVE_TICKET
        data_type: NUMBER(38,0)
      - name: TICKET_HOLDING_TIME_HR
        expr: TICKET_HOLDING_TIME_HR
        data_type: FLOAT
      - name: TOTAL_DOWNTIME_DURATION_HR
        expr: TOTAL_DOWNTIME_DURATION_HR
        data_type: FLOAT
      - name: ISSUE_BAD_CONNECTION
        expr: ISSUE_BAD_CONNECTION
        data_type: NUMBER(38,0)
      - name: ISSUE_LINK_LOSS
        expr: ISSUE_LINK_LOSS
        data_type: NUMBER(38,0)
      - name: ISSUE_HIGH_TEMP
        expr: ISSUE_HIGH_TEMP
        data_type: NUMBER(38,0)
      - name: ISSUE_DYING_GASP
        expr: ISSUE_DYING_GASP
        data_type: NUMBER(38,0)
      - name: URGENCY_VISIT_COUNT
        expr: URGENCY_VISIT_COUNT
        data_type: NUMBER(38,0)
      - name: SCHEDULE_VISIT
        expr: SCHEDULE_VISIT
        data_type: NUMBER(38,0)
      - name: DURATION_HOURS
        expr: DURATION_HOURS
        data_type: FLOAT
      - name: NEW_ACTIVATION
        expr: NEW_ACTIVATION
        data_type: NUMBER(38,0)
      - name: AVG_TICKET_DURATION_HR
        expr: AVG_TICKET_DURATION_HR
        data_type: FLOAT



relationships:
  # Dimensions to dimensions
  - name: DIM_CLUSTER_to_DIM_CITY
    left_table: DIM_CLUSTER
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: DIM_CLUSTER_to_DIM_OLT
    left_table: DIM_CLUSTER
    right_table: DIM_OLT
    relationship_columns:
      - left_column: OLT_KEY
        right_column: OLT_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: DIM_OLT_to_DIM_CITY
    left_table: DIM_OLT
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  # Facts to dimensions (preferred via keys)
  - name: FEEDBACK_to_CITY
    left_table: FACT_CUSTOMER_FEEDBACK
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: FEEDBACK_to_CLUSTER
    left_table: FACT_CUSTOMER_FEEDBACK
    right_table: DIM_CLUSTER
    relationship_columns:
      - left_column: CLUSTER_KEY
        right_column: CLUSTER_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: FEEDBACK_to_OLT
    left_table: FACT_CUSTOMER_FEEDBACK
    right_table: DIM_OLT
    relationship_columns:
      - left_column: OLT_ID
        right_column: OLT_ID
    relationship_type: many_to_one
    join_type: inner

  - name: EVENT_TRANSCRIPTS_to_OLT
    left_table: FACT_EVENT_TRANSCRIPTS
    right_table: DIM_OLT
    relationship_columns:
      - left_column: OLT_ID
        right_column: OLT_ID
    relationship_type: many_to_one
    join_type: inner

  - name: INCIDENT_TREND_to_CITY
    left_table: FACT_INCIDENT_TREND_SUMMARY
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: ML_FEATURES_to_CITY
    left_table: FACT_ML_FEATURES
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: ML_FEATURES_to_CLUSTER
    left_table: FACT_ML_FEATURES
    right_table: DIM_CLUSTER
    relationship_columns:
      - left_column: CLUSTER_KEY
        right_column: CLUSTER_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: ML_FEATURES_to_OLT
    left_table: FACT_ML_FEATURES
    right_table: DIM_OLT
    relationship_columns:
      - left_column: OLT_ID
        right_column: OLT_ID
    relationship_type: many_to_one
    join_type: inner

  - name: NETWORK_CONTEXT_to_CITY
    left_table: FACT_NETWORK_CONTEXT_STATIC
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: NETWORK_CONTEXT_to_OLT
    left_table: FACT_NETWORK_CONTEXT_STATIC
    right_table: DIM_OLT
    relationship_columns:
      - left_column: OLT_ID
        right_column: OLT_ID
    relationship_type: many_to_one
    join_type: inner

  - name: ONT_STATUS_to_CITY
    left_table: FACT_ONT_STATUS
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: ONT_STATUS_to_CLUSTER
    left_table: FACT_ONT_STATUS
    right_table: DIM_CLUSTER
    relationship_columns:
      - left_column: CLUSTER_KEY
        right_column: CLUSTER_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: ONT_STATUS_to_OLT
    left_table: FACT_ONT_STATUS
    right_table: DIM_OLT
    relationship_columns:
      - left_column: OLT_ID
        right_column: OLT_ID
    relationship_type: many_to_one
    join_type: inner

  - name: TICKET_to_CITY
    left_table: FACT_TICKET_SUMMARY
    right_table: DIM_CITY
    relationship_columns:
      - left_column: CITY_KEY
        right_column: CITY_KEY
    relationship_type: many_to_one
    join_type: inner

  - name: TICKET_to_FEEDBACK_by_customer
    left_table: FACT_TICKET_SUMMARY
    right_table: FACT_CUSTOMER_FEEDBACK
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one
    join_type: inner

  # Cross-fact alignment (composite on time + key)
  - name: ONT_STATUS_to_ML_FEATURES_time_key
    left_table: FACT_ONT_STATUS
    right_table: FACT_ML_FEATURES
    relationship_columns:
      - left_column: TIMESTAMP_1H
        right_column: TIMESTAMP_1H
      - left_column: OLT_ID
        right_column: OLT_ID
      - left_column: CLUSTER_ID
        right_column: CLUSTER_ID
    relationship_type: many_to_one
    join_type: inner

  - name: EVENT_TRANSCRIPTS_to_ONT_STATUS_time
    left_table: FACT_EVENT_TRANSCRIPTS
    right_table: FACT_ONT_STATUS
    relationship_columns:
      - left_column: TIMESTAMP_1H
        right_column: TIMESTAMP_1H
      - left_column: OLT_ID
        right_column: OLT_ID
    relationship_type: many_to_one
    join_type: inner

verified_queries:
  - name: hourly_outage_hotspots
    question: |+
      Show the top 10 clusters by current outage ratio in the last 24 hours, including city and OLT, sorted by OFFLINE_ONT_RATIO.
    use_as_onboarding_question: false
    sql: |-
      WITH recent AS (
        SELECT
          s.TIMESTAMP_1H,
          s.CLUSTER_ID,
          s.CLUSTER_KEY,
          s.CLUSTER_NAME,
          s.OLT_ID,
          s.CITY_KEY,
          s.OFFLINE_ONT_RATIO
        FROM HACKATHON.DATAMART.FACT_ONT_STATUS s
        WHERE s.TIMESTAMP_1H >= DATEADD('hour', -24, CURRENT_TIMESTAMP())
      )
      SELECT
        c.CITY,
        dcl.CLUSTER_NAME,
        r.OLT_ID,
        AVG(r.OFFLINE_ONT_RATIO) AS avg_offline_ratio
      FROM recent r
      JOIN HACKATHON.DATAMART.DIM_CITY c    ON r.CITY_KEY   = c.CITY_KEY
      JOIN HACKATHON.DATAMART.DIM_CLUSTER dcl ON r.CLUSTER_KEY = dcl.CLUSTER_KEY
      GROUP BY c.CITY, dcl.CLUSTER_NAME, r.OLT_ID
      ORDER BY avg_offline_ratio DESC
      LIMIT 10
    verified_by: User
    verified_at: 1759161600

  - name: tickets_vs_incidents_daily
    question: |+
      Compare daily ticket counts with daily fault rate for each city in September 2024.
    use_as_onboarding_question: false
    sql: |-
      SELECT
        t.DATE,
        dc.CITY,
        SUM(t.TICKET_OPEN) AS tickets_opened,
        SUM(t.TICKET_CLOSED) AS tickets_closed,
        AVG(i.FAULT_RATE_DAILY) AS avg_fault_rate
      FROM HACKATHON.DATAMART.FACT_TICKET_SUMMARY t
      JOIN HACKATHON.DATAMART.DIM_CITY dc ON t.CITY_KEY = dc.CITY_KEY
      LEFT JOIN HACKATHON.DATAMART.FACT_INCIDENT_TREND_SUMMARY i
            ON i.CITY_KEY = t.CITY_KEY AND i.DATE = t.DATE
      WHERE t.DATE >= '2024-09-01' AND t.DATE < '2024-10-01'
      GROUP BY t.DATE, dc.CITY
      ORDER BY t.DATE, dc.CITY
    verified_by: User
    verified_at: 1759161600

  - name: feedback_sentiment_by_cluster
    question: |+
      What is the average customer rating and sentiment label distribution by cluster this month?
    use_as_onboarding_question: false
    sql: |-
      SELECT
        dcl.CLUSTER_NAME,
        AVG(f.RATING_1_5) AS avg_rating,
        f.SENTIMENT_LABEL,
        COUNT(*) AS cnt
      FROM HACKATHON.DATAMART.FACT_CUSTOMER_FEEDBACK f
      JOIN HACKATHON.DATAMART.DIM_CLUSTER dcl ON f.CLUSTER_KEY = dcl.CLUSTER_KEY
      WHERE DATE_TRUNC('month', CURRENT_DATE()) = DATE_TRUNC('month', f.ACTIVE_DATE)
      GROUP BY dcl.CLUSTER_NAME, f.SENTIMENT_LABEL
      ORDER BY dcl.CLUSTER_NAME, cnt DESC
    verified_by: User
    verified_at: 1759161600
